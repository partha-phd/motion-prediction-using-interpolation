% Function to plot the scenario from the HighD Dataset

function plotH = visualizeScenario(scenario, scenarioNum, idTimeStep)
figure(1);
hold on;
sgtitle('Scenario visualization');
xlabel('X in [m]');
ylabel('Y in [m]');
% Plot the road
plot(scenario(scenarioNum).Road.x(1,:),...
    scenario(scenarioNum).Road.y(1,:), 'w', "LineWidth",3);
plot(scenario(scenarioNum).Road.x(2,:),...
    scenario(scenarioNum).Road.y(2,:), 'w--', "LineWidth",2);
plot(scenario(scenarioNum).Road.x(3,:),...
    scenario(scenarioNum).Road.y(3,:), 'w--', "LineWidth",2);
plot(scenario(scenarioNum).Road.x(4,:),...
    scenario(scenarioNum).Road.y(4,:), 'w', "LineWidth",3);
set(gca,'Color', [0.6 0.6 0.6])
axis equal
% Plot the ego vehicle
[xBox, yBox] = ...
    calcBoundingBox(scenario(scenarioNum).EGO.xCG_New(idTimeStep),...
    scenario(scenarioNum).EGO.yCG_New(idTimeStep),...
    deg2rad(scenario(scenarioNum).EGO.psi_New(idTimeStep)),...
    scenario(scenarioNum).EGO.bbox(idTimeStep, 3),...
    scenario(scenarioNum).EGO.bbox(idTimeStep, 4));
plotH(1) = patch(xBox, yBox, 'g');
% Plot the target vehicle
for idTarget = 1:size(scenario(scenarioNum).Target,2)
    [xBox, yBox] = ...
        calcBoundingBox(scenario(scenarioNum).Target(idTarget).xCG_New(idTimeStep),...
        scenario(scenarioNum).Target(idTarget).yCG_New(idTimeStep),...
        deg2rad(scenario(scenarioNum).Target(idTarget).psi_New(idTimeStep)),...
        scenario(scenarioNum).Target(idTarget).bbox(idTimeStep, 3),...
        scenario(scenarioNum).Target(idTarget).bbox(idTimeStep, 4));
    plotH(end + 1) = patch(xBox, yBox, 'r');
plot(scenario(scenarioNum).Target(idTarget).xCG_New(idTimeStep:75),...
    scenario(scenarioNum).Target(idTarget).yCG_New(idTimeStep:75), 'r', 'LineWidth', 2);
    
end


% Plot the trajectories for 3 seconds
plot(scenario(scenarioNum).EGO.xCG_New(idTimeStep:75),...
    scenario(scenarioNum).EGO.yCG_New(idTimeStep:75), 'g', 'LineWidth', 2);
hold off;
end
